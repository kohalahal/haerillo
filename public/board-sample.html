<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
    <title>Board</title>
</head>
<body>
  <header>
      <div class="nav-container">
        <div class="logo">
          <a href="../">Haerillo</a>
        </div>
        <nav>
          <ul>
            <li>
              <button onclick="logout();">Logout</button>
            </li>
          </ul>
        </nav>
      <!-- end of nav-container -->
      </div>
  </header>
  <section>
      <div class="main-container">

          <!-- TODO
          보드, 리스트, 카드 모양 만들기 -->

          <div class="board">
            <div id="board-id" style="display: none;">37</div>
            <div class="board-title">
              <h3>보드 제목</h3>
            </div>
            <ul class="list-container">
              <li class="list">
                <div class="text-container">
                  <div class="delete-btn">
                    <i class="fas fa-trash-alt "></i>
                  </div>
                  <div class="list-title text">
                    <h4>리스트 제목</h4>
                  </div>
                  
                </div>
                <ul class="card-container">
                  <li class="card active">
                    <div class="delete-btn">
                      <i class="fas fa-trash-alt "></i>
                    </div>
                    <div class="text-container">
                      <div class="card-content text">
                        카드 제목
                      </div>
                      
                    </div>
                  </li>
                  <li class="card active">
                    <div class="delete-btn">
                      <i class="fas fa-trash-alt "></i>
                    </div>
                    <div class="text-container">
                      <div class="card-title text">
                        카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목카드 제목
                      </div>

                      
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <textarea class="list-input"></textarea>
                      <div class="ok-btn-container">
                        <a class="ok-btn">OK</a>
                      </div>
                    </div>
                  </li>
                  
                </ul>
              </li>
              <li class="list">
                <div class="text-container">
                  <input type="text" class="list-input">
                  <i class="fas fa-trash-alt"></i>
                </div>
                <ul class="card-container">
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                </ul>
              </li>
              <li class="list">
                <div class="text-container">
                  <input type="text" class="list-input">
                  <button>OK</button>
                </div>
                <ul class="card-container">
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  
                </ul>
              </li>
              <li class="list">
                <div class="text-container">
                  <input type="text" class="list-input">
                  <button>OK</button>
                </div>
                <ul class="card-container">
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                </ul>
              </li>
              <li class="list">
                <div class="text-container">
                  <input type="text" class="list-input">
                  <a class="ok-btn">OK</a>
                </div>
                <ul class="card-container">
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                </ul>
              </li>
              <li class="list">
                <div class="text-container">
                  <input type="text" class="list-input">
                  <button>OK</button>
                </div>
                <ul class="card-container">
                  
                </ul>
              </li>
              <li class="list">
                <div class="text-container">
                  <div class="input-container">
                    <input type="text" class="list-input">

                  </div>
                  <div class="ok-btn-container">
                    <a class="ok-btn">OK</a>
                  </div>
                </div>
                <ul class="card-container">
                  <li class="card">
                    <div class="text-container">
                      <input type="text" class="list-input">
                      <button>OK</button>
                    </div>
                  </li>
                  <li class="card inactive">
                    <div class="text-container text">
                      <a class="add-list-btn ${this.id}">+ 리스트 등록</a>
                    </div>
                  </li>
                </ul>
              </li>
              <li class="list">
                <div class="text-container text add-list">
                  + 리스트 등록
                </div>
                
              </li>
            <!-- end of list-container -->
            </ul>

          <!-- end of board -->
          </div>

      <!-- end of main-container -->
      </div>
  </section>
  <script src="https://kit.fontawesome.com/a18004eea6.js" crossorigin="anonymous"></script>
  <script type="text/javascript">
    const boardId = document.querySelector('#board-id').innerText;
    const addListBtn = document.querySelector('.add-list');
    const lists = document.querySelectorAll('.list');
    addListBtn.addEventListener("click", makeListInput);

    function makeListInput() {
      addListBtn.innerHTML = `<input type="text" name="list">
                              <a class="list-ok-btn" onclick="addList(this)">OK</a>`;
      addListBtn.removeEventListener("click", makeListInput);
    }

    function addList() {
      const title = document.querySelector('input[name="list"]').value;
      addlistevent = this;
      // const index;
      const index = lists.length;
      const list = new List(boardId, title, index);
      console.log(title, boardId, index);
      console.log(list);
      const url = "http://localhost:3000/boards/lists"
      const createList = function(url, callback) {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', url, true);
        xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem("token"));
        xhr.responseType = 'json';
        xhr.onload = function() {
            const status = xhr.status;
          if (status === 200) {
            callback(null, xhr.response);
          } else {
            callback(status, xhr.response);
          }
        };
        xhr.send();
      };
      createList(url, (err, message) => {
          if(err) {
              alert('Something went wrong: ' + err);
          } else {
              console.log(message);
          }
      });
    }


    function List(boardId, title, index) {
      this.boardId = boardId;
      this.title = title;
      this.index = index;
    }


      /* TODO
          0.보드 정보 받아와서 보여주기
          1.보드,리스트,카드 입력시 POST
          2.드래그 앤 드롭으로 수정 & POST
          3.SSE 이벤트 데이터로 보드 갱신
              1.2.3 실패시 로그인 창으로 보내기
      */

      // const sse = new EventSource('http://localhost:3000/stream');
      // sse.onmessage = function(e) {
      //   console.log('event'+e.data);
      //   var news = document.createElement('div');
      //   news.innerHTML = e.data;
      //   document.getElementById('sse').appendChild(news);
      // };
  
      // function btnClick() {
      //   // const form = document.createElement('form');
      //   // form.method = 'post';
      //   // form.path = '/users';
      //   // form.appendChild(docu)
      //   var xhr = new XMLHttpRequest();
      //   xhr.open("POST", '/users', true);
      //   xhr.setRequestHeader('Content-Type', 'application/json');
      //   xhr.send(JSON.stringify({
      //       username: 'value'
      //   }));
      // };
  
  
    </script>
  
</body>
</html>